package se.raweden.ui.view{		import flash.display.DisplayObjectContainer;	import flash.display.Sprite;	import flash.events.Event;	import flash.events.MouseEvent;	import flash.geom.Point;	import flash.geom.Rectangle;		import se.raweden.motion.Tween;
			/**	 * Dispatched when the procent property is changed by user interaction.	 */	[Event(name="scroll", type="flash.events.Event")]
			/**	 * A <code>UIScroller</code> component is a simple overlay scroller.	 * 	 * <p>Copyright 2011 Raweden. All rights reserved.</p>	 * 	 * @author Raweden	 */	public class UIScroller extends UIControl{				// static constats		public static const DIRECTION_VERTICAL:String = "vertical";		public static const DIRECTION_HORIZONTAL:String = "horizontal";				private var _procent:Number = 0;		private var _isVertical:Boolean = true;		private var _alwaysVisible:Boolean = true;		private var _indicatorStyle:String = "";		private var _ratio:Number = 0.25;				private var dragPoint:Point;		private var thumb:Sprite		private var track:Sprite;				/**		 * Constructor.		 * 		 * @param parent		 */		public function UIScroller(parent:DisplayObjectContainer = null){			super(parent);			addChildren();			init();		}						/**		 * Creates and adds related view instances.		 */		private function addChildren():void{			// creating the track.			track = new Sprite();			track.addEventListener(MouseEvent.CLICK,onTrackClick);			this.addChild(track);			// creating the thumb.			thumb = new Sprite();			thumb.addEventListener(MouseEvent.MOUSE_DOWN,dragStart);			this.addChild(thumb);		}				/**		 * Instance Initilazation.		 */		private function init():void{			this.resize(8,256);		}				//------------------------------------ 		// Responding to User Interaction.		//------------------------------------		/**		 * Triggers as the scroll track is clicked by the user.		 */		private function onTrackClick(e:MouseEvent):void{			//var procent:Number = track.mouseY / track.height;			//this.procent = procent;		}				/**		 * Triggerd when the user presses down the handle.		 */		private function dragStart(e:MouseEvent):void{			dragPoint = new Point(thumb.mouseX,thumb.mouseY);			stage.addEventListener(MouseEvent.MOUSE_MOVE,dragMove);			stage.addEventListener(MouseEvent.MOUSE_UP,dragStop);			trace("start drag scroller");		}				/**		 * Triggerd when the mouse moves over the stage after the handle have been pressed down.		 */		private function dragMove(e:MouseEvent):void{			var max:int; 			var min:int;			var p:int;			if(_isVertical){				// carculating maximum and minimal output value.				max = height-thumb.height;				min = 0;				// applaying logics.				p = mouseY-dragPoint.y;				p = p < min ? min : p;				p = p > max ? max : p;				// setting thumb vertical position.				thumb.y = p;			}else{				// carculating maximum and minimal output value.				max = width-thumb.width;				min = 0;				// applying logics.				p = mouseX-dragPoint.x;				p = p < min ? min : p;				p = p > max ? max : p;				// setting thumb horizontal position.				thumb.x = p;			}			// carculating scroll procentage.			var procent:Number = p/max;			if(procent != _procent){				_procent = procent;				this.dispatchEvent(new Event(Event.SCROLL));			}			e.updateAfterEvent();		}				/**		 * Triggerd when the mouse relases over the stage after the handle have been pressed down.		 */		private function dragStop(e:MouseEvent):void{			dragPoint = null;			stage.removeEventListener(MouseEvent.MOUSE_MOVE,dragMove);			stage.removeEventListener(MouseEvent.MOUSE_UP,dragStop);		}				//------------------------------------		// Getting and Setting Attributes.		//------------------------------------				/**		 * A Number representing the procentage the Handle is down the track.		 * 		 * @default <code>0.0</code>		 */		public function set procent(value:Number):void{			value = value < 0 ? 0 : value;			value = value > 1 ? 1 : value;			if(value != _procent){				_procent = value;				// Setting the position of the handle.				if(_isVertical){					thumb.y = Math.round(value*(height - thumb.height));				}else{					thumb.x = Math.round(value*(width -  thumb.height));				}			}		}		// returns the value of the procent attribute.		public function get procent():Number{			return(_procent);		}				/**		 * A Number representing the ratio of the content length to the visible length.		 * 		 * @default <code>0.5</code>		 */		public function set ratio(value:Number):void{			value = value > 1 ? 1 : value;			value = value < 0 ? 0 : value;			if(_ratio == value)return;			enabled = value > 0 && value < 1;			_ratio = value;			needs("draw",draw);		}		// returns the value of the ratio attribute.		public function get ratio():Number{			return(_ratio);		}				/**		 * 		 * 		 * @default <code>UIScroller.DIRECTION_VERTICAL</code>		 */		public function set direction(value:String):void{				var vertical:Boolean = value == DIRECTION_HORIZONTAL ? false : true;			if(vertical != _isVertical){				this.resize(height,width);				_isVertical = vertical;				needs("draw",draw);			}		}		// returns the value of the direction attribute.		public function get direction():String{			return _isVertical ? DIRECTION_VERTICAL : DIRECTION_HORIZONTAL		}		//------------------------------------		// Flashing and Showing Scroller		//------------------------------------				/**		 * 		 */		public final function flash():void{			if(!_alwaysVisible){				_fadeIn();				_fadeOut(1.5);			}		}				/**		 * 		 */		public final function quickFlash():void{			if(_alwaysVisible){				_fadeIn();				_fadeOut(0.5);			}		}				// Fades out the Scroller.		private function _fadeOut(delay:Number = 0):void{			Tween.to(this,0.33,{alpha:0,delay:delay}).start();		}				// Fades in the Scorller.		private function _fadeIn(delay:Number = 0):void{			Tween.to(this,0.33,{alpha:1,delay:delay}).start();		}		/**		 * 		 */		public function set alwaysVisible(value:Boolean):void{			_alwaysVisible = value;		}		// Determine if the Scroller is allways visible.		public function get alwaysVisible():Boolean{			return _alwaysVisible;		}				//------------------------------------		// Customize the Scroller.		//------------------------------------						/**		 * 		 */		public function set indicatorStyle(value:String):void{
			_indicatorStyle = value;			needs("draw",draw);
		}		// returns the value of the indicatorStyle attribute.		public function get indicatorStyle():String{			return _indicatorStyle;		}		//------------------------------------		// Draw the graphics onto the Sub Components.		//------------------------------------						/**		 * @inheritDoc		 */		protected override function draw(rect:Rectangle):void{			var w:int = rect.width;			var h:int = rect.height;			var r:Number = _ratio;			// draws the track.			track.graphics.clear();			track.graphics.beginFill(0x2D2D2D,0.1);			if(_isVertical){				track.graphics.drawRoundRect(0,0,w,h,w,w) 			}else{				track.graphics.drawRoundRect(0,0,w,h,h,h);			}			track.graphics.endFill();			// draws the thumb.			thumb.graphics.clear();			thumb.graphics.beginFill(0x000000,0.50);			if(_isVertical){				thumb.graphics.drawRoundRect(0,0,w,int(h*r),w,w)			}else{				thumb.graphics.drawRoundRect(0,0,int(w*r),h,h,h);			}			// adjusting the position of the thumb.			if(_isVertical){				thumb.y = int(_procent*(height - thumb.height));				}else{				thumb.x = int(_procent*(width - thumb.width));			}		}				//------------------------------------		// Deconstruction		//------------------------------------				/**		 * @inheritDoc		 */		override public function dispose():void{			// destoying the super implemenation.			super.dispose();		}			}}